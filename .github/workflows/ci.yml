name: CI - GameServer Only

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  validate:
    runs-on: windows-latest
    name: Validate GameServer Project
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      
    - name: Validate GameServer files
      run: |
        Write-Host "=== Validating GameServer Project ===" -ForegroundColor Cyan
        
        # Check solution file
        $solution = "GameServer\NNOGameServer.sln"
        if (Test-Path $solution) {
            Write-Host "OK: $solution" -ForegroundColor Green
        } else {
            Write-Host "ERROR: $solution (not found)" -ForegroundColor Red
            exit 1
        }
        
        # Check project file
        $project = "GameServer\NNOGameServer.vcxproj"
        Write-Host ""
        Write-Host "=== Project File ===" -ForegroundColor Cyan
        if (Test-Path $project) {
            Write-Host "OK: $project" -ForegroundColor Green
        } else {
            Write-Host "ERROR: $project (not found)" -ForegroundColor Red
            exit 1
        }
        
        # Check key source files
        Write-Host ""
        Write-Host "=== Key Source Files ===" -ForegroundColor Cyan
        $sources = @(
            "GameServer\NNOLogging.c",
            "Common\NNOCommon.c",
            "Common\NNOCommon.h"
        )
        
        foreach ($src in $sources) {
            if (Test-Path $src) {
                Write-Host "OK: $src" -ForegroundColor Green
            } else {
                Write-Host "WARNING: $src (not found)" -ForegroundColor Yellow
            }
        }
        
        # Check build scripts
        Write-Host ""
        Write-Host "=== Build Scripts ===" -ForegroundColor Cyan
        $scripts = @(
            "build.ps1",
            "setup_dependencies.ps1"
        )
        
        foreach ($script in $scripts) {
            if (Test-Path $script) {
                Write-Host "OK: $script" -ForegroundColor Green
            } else {
                Write-Host "WARNING: $script (not found)" -ForegroundColor Yellow
            }
        }
      shell: pwsh
      
    - name: Check file structure
      run: |
        Write-Host "=== GameServer Directory Structure ===" -ForegroundColor Cyan
        if (Test-Path "GameServer") {
            Get-ChildItem "GameServer" -Directory | Select-Object Name | Format-Table -AutoSize
        } else {
            Write-Host "ERROR: GameServer directory not found" -ForegroundColor Red
            exit 1
        }
      shell: pwsh
